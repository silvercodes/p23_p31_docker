
services:
    mysql:
        image: mysql:latest
        container_name: mysql_cnt
        hostname: mysql
        restart: always     #unless-stopped
        ports:
            - '3306:3306'
        networks:
            - my-net
        environment:
            MYSQL_ROOT_PASSWORD: rootpassword 
            MYSQL_DATABASE: test_db
            MYSQL_USER: appuser 
            MYSQL_PASSWORD: userpassword
        volumes:
            # 1 Хранение данных в именованом томе
            # - mysql_data:/var/lib/mysql
            # OR
            # 2. Хранение данных в папке на хосте
            - ./data:/var/lib/mysql

            # Логи
            - ./logs:/var/log/mysql

            # стартовый скрипт
            - ./init/init.sql:/docker-entrypoint-initdb.d/init.sql

            # конфигурации mysql
            - ./conf.d:/etc/mysql/conf.d:ro
        healthcheck:
            test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-prootpassword"]
            start_period: 3s
            interval: 3s
            timeout: 3s
            retries: 3
        
networks:
    my-net:
        driver: bridge
# volumes:
    # mysql_data:
    #     driver: local

